# LAB WEEK 11 - ASSIGNMENT ANSWERS

## Question 1
**When a user takes a picture, that picture is stored in a path based on the given URI. In which part of the code handles this?**

**Answer:**
```kotlin
takePictureLauncher = registerForActivityResult(ActivityResultContracts.TakePicture()) {
    providerFileManager.insertImageToStore(photoInfo)
}
```

The ActivityResultContracts.TakePicture() contract automatically handles saving the picture to the URI that was passed to takePictureLauncher.launch(photoInfo?.uri). After the photo is taken, the callback executes insertImageToStore() to copy it to MediaStore.

---

## Question 2
**In your FileInfo.kt, there are 5 attributes. On the first attribute, what does the URI refer to? And on the fourth attribute, what does relativePath refer to?**

**Answer:**

**First attribute - URI:**
The URI refers to a temporary content URI generated by FileProvider that points to the file location in the app's private external storage. This URI is used to grant temporary access to the camera app to save the captured photo/video. Example: `content://com.example.lab_week_11_b.camera/photos/img_1234567890.jpg`

**Fourth attribute - relativePath:**
The relativePath refers to the relative directory path within the external storage where the file will be stored in MediaStore. For photos, it's "Pictures" (Environment.DIRECTORY_PICTURES), and for videos, it's "Movies" (Environment.DIRECTORY_MOVIES). This determines the folder structure visible to users in their Gallery app.

---

## Question 3 [BONUS]
**Explain the chronological order from when a user takes a picture until the file is stored in the MediaStore.**

**Answer:**

1. **User clicks Photo button** → `checkStoragePermission()` is called to verify WRITE_EXTERNAL_STORAGE permission (only for Android 9 and below)

2. **Permission granted** → `openImageCapture()` is executed

3. **Generate FileInfo** → `providerFileManager.generatePhotoUri()` creates:
   - A File object in app's private external directory: `/Android/data/com.example.lab_week_11_b/files/Pictures/img_[timestamp].jpg`
   - A temporary content URI using FileProvider
   - FileInfo object containing all metadata (URI, file, name, relativePath, mimeType)

4. **Launch Camera** → `takePictureLauncher.launch(photoInfo?.uri)` opens the camera app with the FileProvider URI

5. **User captures photo** → Camera app saves the image directly to the provided URI location (app's private storage)

6. **Camera returns result** → The ActivityResultContracts.TakePicture() callback is triggered

7. **Insert to MediaStore** → `providerFileManager.insertImageToStore(photoInfo)` is called, which:
   - Generates ContentValues with file metadata (DISPLAY_NAME, RELATIVE_PATH, MIME_TYPE)
   - Calls `contentResolver.insert()` to create a new entry in MediaStore
   - Opens InputStream from the FileProvider URI (source file)
   - Opens OutputStream to the MediaStore URI (destination)
   - Uses IOUtils.copy() to copy the file content to MediaStore

8. **File available in Gallery** → The photo is now visible in the Gallery app because it's registered in MediaStore at the path: `/storage/emulated/0/Pictures/img_[timestamp].jpg`

The entire process runs asynchronously using an Executor to avoid blocking the main thread.